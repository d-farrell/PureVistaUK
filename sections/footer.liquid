<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<div
  class="section section--{{ section.settings.section_width }} color-{{ section.settings.color_scheme }}"
>
  {%- liquid
    assign menu_block_count = 0
    for block in section.blocks
      if block.type == 'menu'
        assign menu_block_count = menu_block_count | plus: 1
      endif
    endfor
  -%}

  <div
    class="pv-footer spacing-style"
    style="{% render 'spacing-style', settings: section.settings %}"
  >
    {%- for block in section.blocks -%}
      {%- if block.type == 'logo' -%}
        {%- liquid
          assign logo = block.settings.image | default: settings.logo
          assign logo_width = block.settings.logo_width
        -%}

        {%- if logo -%}
          <div class="pv-footer__logo" {{ block.shopify_attributes }}>
            <a href="{{ routes.root_url }}" aria-label="{{ shop.name }}">
              {{-
                logo
                | image_url: width: 3840
                | image_tag:
                  width: logo.width,
                  widths: '120, 240, 352, 480',
                  height: logo.height,
                  class: 'pv-footer__logo-img',
                  alt: shop.name,
                  loading: 'lazy'
              -}}
            </a>
          </div>
        {%- endif -%}
      {%- endif -%}
    {%- endfor -%}

    <div class="pv-footer__content">
      {%- if menu_block_count > 0 -%}
        <div
          class="pv-footer__nav"
          style="--nav-columns: {{ menu_block_count | at_most: 4 }};"
        >
          {%- for block in section.blocks -%}
            {%- if block.type == 'menu' -%}
              <div class="pv-footer__nav-col" {{ block.shopify_attributes }}>
                {%- if block.settings.menu != blank -%}
                  <ul class="pv-footer__nav-list list-unstyled" role="list">
                    {%- for link in block.settings.menu.links -%}
                      {%- liquid
                        assign is_heading = false
                        assign link_title = link.title
                        if link.title contains ':: Heading'
                          assign is_heading = true
                          assign link_title = link.title | split: ':: Heading' | first | strip
                        endif
                      -%}
                      <li class="pv-footer__nav-item {% if is_heading %}pv-footer__nav-item--heading {% else %}pv-footer__nav-item--link{% endif %} {% if link.links != blank %}pv-footer__nav-item--has-children{% endif %}">
                        <a
                          href="{{ link.url }}"
                          {% if is_heading %}
                            class="pv-footer__nav-link pv-footer__nav-link--heading"
                          {% endif %}
                        >
                          {{- link_title -}}
                        </a>
                        {%- if link.links != blank -%}
                          <ul class="pv-footer__nav-list pv-footer__nav-list--children list-unstyled" role="list">
                            {%- for child in link.links -%}
                              {%- liquid
                                assign child_heading = false
                                assign child_title = child.title
                                if child.title contains ':: Heading'
                                  assign child_heading = true
                                  assign child_title = child.title | split: ':: Heading' | first | strip
                                endif
                              -%}
                              <li class="pv-footer__nav-item {% if child_heading %}pv-footer__nav-item--heading {% else %}pv-footer__nav-item--link{% endif %}">
                                <a
                                  href="{{ child.url }}"
                                  {% if child_heading %}
                                    class="pv-footer__nav-link pv-footer__nav-link--heading"
                                  {% endif %}
                                >
                                  {{- child_title -}}
                                </a>
                              </li>
                            {%- endfor -%}
                          </ul>
                        {%- endif -%}
                      </li>
                    {%- endfor -%}
                  </ul>
                {%- endif -%}
              </div>
            {%- endif -%}
          {%- endfor -%}
        </div>
      {%- endif -%}

      {%- for block in section.blocks -%}
        {%- if block.type == 'newsletter' -%}
          <div class="pv-footer__subscribe" {{ block.shopify_attributes }}>
            {%- if block.settings.heading != blank -%}
              <h3 class="pv-footer__subscribe-heading">{{ block.settings.heading }}</h3>
            {%- endif -%}

            {%- form 'customer', class: 'pv-footer__subscribe-form' -%}
              <div class="pv-footer__subscribe-input-group">
                <label for="FooterEmailInput-{{ block.id }}" class="visually-hidden">
                  {{ 'blocks.email_signup.label' | t }}
                </label>
                <input
                  id="FooterEmailInput-{{ block.id }}"
                  class="pv-footer__subscribe-input"
                  type="email"
                  name="contact[email]"
                  autocorrect="off"
                  autocapitalize="off"
                  autocomplete="email"
                  placeholder="{{ 'blocks.email_signup.placeholder' | t }}"
                  required
                  {%- if form.errors -%}
                    autofocus
                    aria-invalid="true"
                    aria-describedby="FooterEmail-error-{{ block.id }}"
                  {%- elsif form.posted_successfully? -%}
                    aria-describedby="FooterEmail-success-{{ block.id }}"
                  {%- endif -%}
                >
                <button
                  type="submit"
                  class="pv-footer__subscribe-button"
                  aria-label="{{ 'actions.sign_up' | t }}"
                >
                  <svg
                    viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg"
                    focusable="false"
                    aria-hidden="true"
                    class="pv-footer__subscribe-icon"
                  >
                    {%- render 'icon', icon: 'arrow' -%}
                  </svg>
                </button>
              </div>

              {%- if form.errors -%}
                <div
                  id="FooterEmail-error-{{ block.id }}"
                  class="pv-footer__subscribe-message pv-footer__subscribe-message--error"
                  tabindex="-1"
                >
                  <svg
                    viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg"
                    focusable="false"
                    aria-hidden="true"
                    class="icon-error"
                  >
                    {%- render 'icon', icon: 'error' -%}
                  </svg>
                  {{- form.errors.translated_fields.email | capitalize }}
                  {{ form.errors.messages.email -}}
                </div>
              {%- endif -%}

              {%- if form.posted_successfully? -%}
                <div
                  id="FooterEmail-success-{{ block.id }}"
                  class="pv-footer__subscribe-message pv-footer__subscribe-message--success"
                  tabindex="-1"
                >
                  <span class="svg-wrapper icon-success">
                    {{ 'icon-checkmark.svg' | inline_asset_content }}
                  </span>
                  <p>{{ 'blocks.email_signup.success' | t }}</p>
                </div>
              {%- endif -%}
            {%- endform -%}
          </div>
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>
</div>

{% stylesheet %}
  .pv-footer {
    display: flex;
    flex-direction: column;
    gap: 32px;
  }

  .pv-footer__logo {
    display: flex;
  }

  .pv-footer__logo a {
    display: inline-flex;
  }

  .pv-footer__logo-img {
    width: auto;
    height: auto;
    object-fit: contain;
    @media screen and (min-width: 750px) {
      width: 213px;
      height: auto;
    }
  }

  .pv-footer__content {
    display: flex;
    flex-direction: column;
    gap: 50px;
    @media screen and (min-width: 990px) {
      flex-direction: row;
    }
  }

  .pv-footer__nav {
    display: grid;
    grid-template-columns: 1fr;
    gap: 32px;
    @media screen and (min-width: 750px) {
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
    }
    @media screen and (min-width: 990px) {
      grid-template-columns: repeat(var(--nav-columns, 4), 1fr);
      gap: 32px;
      flex: 1;
    }
  }

  .pv-footer__nav-col {
    display: flex;
    flex-direction: column;
  }

  .pv-footer__nav-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin: 0;
    padding: 0;
    list-style: none;
  }

  .pv-footer__nav-list--children {
    margin-top: 4px;
    gap: 4px;
  }

  .pv-footer__nav-item--link a {
    font-family: var(--font-body--family);
    font-size: 12px;
    line-height: 1.5;
    text-transform: uppercase;
    color: rgb(96 114 130);
    text-decoration: none;
    transition: opacity 0.2s ease;
  }

  .pv-footer__nav-link--heading {
    font-size: 16px;
    font-weight: 700;
    text-transform: uppercase;
    color: #02325c;
  }

  .pv-footer__nav-item--link a:hover {
    opacity: 0.7;
  }

  .pv-footer__nav-item--link a:focus-visible {
    outline: 2px solid var(--color-foreground);
    outline-offset: 2px;
  }

  .pv-footer__subscribe {
    display: flex;
    flex-direction: column;
    gap: 16px;
    @media screen and (min-width: 990px) {
      flex: 0 0 280px;
      max-width: 320px;
    }
  }

  .pv-footer__subscribe-heading {
    font-family: var(--font-heading--family);
    font-weight: var(--font-heading--weight);
    font-size: 14px;
    line-height: 1.4;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--color-foreground-heading);
    margin: 0;
  }

  .pv-footer__subscribe-form {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .pv-footer__subscribe-input-group {
    display: flex;
    align-items: stretch;
    border: 1px solid var(--color-input-border);
    border-radius: 4px;
    overflow: hidden;
    background-color: var(--color-input-background);
  }

  .pv-footer__subscribe-input {
    flex: 1;
    min-width: 0;
    border: none;
    padding: 10px 14px;
    font-family: var(--font-body--family);
    font-size: 12px;
    color: var(--color-input-text);
    background-color: transparent;
    outline: none;
  }

  .pv-footer__subscribe-input::placeholder {
    color: rgb(var(--color-input-text-rgb) / var(--opacity-50));
    text-transform: capitalize;
  }

  .pv-footer__subscribe-input:focus-visible {
    outline: 2px solid var(--color-foreground);
    outline-offset: -2px;
  }

  .pv-footer__subscribe-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    flex-shrink: 0;
    border: none;
    border-left: 1px solid var(--color-input-border);
    background-color: transparent;
    cursor: pointer;
    color: var(--color-primary);
    transition: background-color 0.2s ease;
    padding: 0;
  }

  .pv-footer__subscribe-button:hover {
    background-color: var(--color-input-hover-background);
  }

  .pv-footer__subscribe-button:focus-visible {
    outline: 2px solid var(--color-foreground);
    outline-offset: -2px;
  }

  .pv-footer__subscribe-icon {
    width: 20px;
    height: 20px;
  }

  .pv-footer__subscribe-message {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
  }

  .pv-footer__subscribe-message--error {
    color: var(--color-error);
  }

  .pv-footer__subscribe-message--success {
    color: var(--color-success);
  }

  .pv-footer__subscribe-message p {
    margin: 0;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Footer",
  "class": "section-wrapper",
  "tag": "footer",
  "enabled_on": {
    "groups": ["footer"]
  },
  "settings": [
    {
      "type": "select",
      "id": "section_width",
      "label": "t:settings.width",
      "options": [
        {
          "value": "page-width",
          "label": "t:options.page"
        },
        {
          "value": "full-width",
          "label": "t:options.full"
        }
      ],
      "default": "page-width"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "logo",
      "name": "Logo",
      "limit": 1,
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Logo image"
        },
        {
          "type": "paragraph",
          "content": "If no image is selected, the theme logo will be used."
        },
        {
          "type": "range",
          "id": "logo_width",
          "label": "Logo width",
          "min": 60,
          "max": 400,
          "step": 10,
          "unit": "px",
          "default": 200
        }
      ]
    },
    {
      "type": "menu",
      "name": "Menu column",
      "settings": [
        {
          "type": "link_list",
          "id": "menu",
          "label": "Menu"
        }
      ]
    },
    {
      "type": "newsletter",
      "name": "Newsletter",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Subscribe to the Pure Vista mailing list."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Footer",
      "category": "t:categories.footer",
      "blocks": [
        {
          "type": "logo"
        },
        {
          "type": "menu"
        },
        {
          "type": "menu"
        },
        {
          "type": "menu"
        },
        {
          "type": "menu"
        },
        {
          "type": "newsletter"
        }
      ]
    }
  ]
}
{% endschema %}
